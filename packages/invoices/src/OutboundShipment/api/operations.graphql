fragment OutboundShipmentLine on InvoiceLineNode {
  __typename
  type
  batch
  costPricePerPack
  expiryDate
  id
  itemCode
  itemId
  itemName
  numberOfPacks
  packSize
  note
  invoiceId
  location {
    __typename
    ... on LocationNode {
      __typename
      id
      name
      code
      onHold
      stock {
        __typename
        totalCount
        nodes {
          id
          costPricePerPack
          itemId
          availableNumberOfPacks
          onHold
          packSize
          sellPricePerPack
          storeId
          totalNumberOfPacks
        }
      }
    }
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
  }
  item {
    __typename
    id
    name
    code
    isVisible
    unitName
    availableBatches(storeId: $storeId) {
      totalCount
      nodes {
        id
        availableNumberOfPacks
        costPricePerPack
        itemId
        onHold
        packSize
        sellPricePerPack
        storeId
        totalNumberOfPacks
        expiryDate
      }
    }
  }
  locationName
  sellPricePerPack
  stockLine {
    __typename
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
    ... on StockLineNode {
      __typename
      availableNumberOfPacks
      batch
      costPricePerPack
      expiryDate
      id
      itemId
      packSize
      sellPricePerPack
      storeId
      totalNumberOfPacks
      onHold
      note
    }
  }
}

fragment OutboundShipment on InvoiceNode {
  __typename
  id
  comment
  createdDatetime
  allocatedDatetime
  deliveredDatetime
  pickedDatetime
  shippedDatetime
  verifiedDatetime
  invoiceNumber
  colour
  onHold

  otherParty {
    __typename
    ... on NameNode {
      __typename
      id
      name
      code
      isCustomer
      isSupplier
    }

    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
  }

  lines {
    ... on InvoiceLineConnector {
      __typename
      nodes {
        ...OutboundShipmentLine
      }
      totalCount
    }
  }
  otherPartyId
  otherPartyName
  pricing {
    __typename
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
    ... on InvoicePricingNode {
      __typename
      totalAfterTax
      totalBeforeTax
      stockTotalBeforeTax
      stockTotalAfterTax
      serviceTotalAfterTax
      serviceTotalBeforeTax
    }
  }
  status
  theirReference
  type
}

fragment OutboundShipmentRow on InvoiceNode {
  __typename
  comment
  createdDatetime
  allocatedDatetime
  deliveredDatetime
  pickedDatetime
  shippedDatetime
  verifiedDatetime
  id
  invoiceNumber
  otherPartyId
  otherPartyName
  theirReference
  type
  status
  colour
  pricing {
    __typename
    ... on NodeError {
      __typename
      error {
        ... on RecordNotFound {
          __typename
          description
        }
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        description
      }
    }
    ... on InvoicePricingNode {
      __typename
      totalAfterTax
      totalBeforeTax
      stockTotalBeforeTax
      stockTotalAfterTax
      serviceTotalAfterTax
      serviceTotalBeforeTax
    }
  }
}

query invoices(
  $first: Int
  $offset: Int
  $key: InvoiceSortFieldInput!
  $desc: Boolean
  $filter: InvoiceFilterInput
  $storeId: String!
) {
  invoices(
    page: { first: $first, offset: $offset }
    sort: { key: $key, desc: $desc }
    filter: $filter
    storeId: $storeId
  ) {
    ... on InvoiceConnector {
      __typename
      nodes {
        ...OutboundShipmentRow
      }
      totalCount
    }
  }
}

query invoice($id: String!, $storeId: String!) {
  invoice(id: $id, storeId: $storeId) {
    __typename
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
    ... on InvoiceNode {
      ...OutboundShipment
    }
  }
}

mutation insertOutboundShipment(
  $id: String!
  $otherPartyId: String!
  $storeId: String!
) {
  insertOutboundShipment(
    storeId: $storeId
    input: { id: $id, otherPartyId: $otherPartyId }
  ) {
    __typename
    ... on InvoiceNode {
      id
    }
    ... on InsertOutboundShipmentError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on ForeignKeyError {
          __typename
          description
          key
        }
        ... on OtherPartyCannotBeThisStoreError {
          __typename
          description
        }
        ... on OtherPartyNotACustomerError {
          __typename
          description
          otherParty {
            code
            id
            isCustomer
            isSupplier
            name
          }
        }
        ... on RecordAlreadyExist {
          __typename
          description
        }
      }
    }
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
  }
}

mutation updateOutboundShipment($input: UpdateOutboundShipmentInput!) {
  updateOutboundShipment(input: $input) {
    ... on InvoiceNode {
      __typename
      id
    }
    ... on NodeError {
      __typename
      error {
        description
        ... on DatabaseError {
          __typename
          description
          fullError
        }
        ... on RecordNotFound {
          __typename
          description
        }
      }
    }
    ... on UpdateOutboundShipmentError {
      __typename
      error {
        description
      }
    }
  }
}

mutation deleteOutboundShipments(
  $storeId: String!
  $deleteOutboundShipments: [String!]!
) {
  batchOutboundShipment(
    storeId: $storeId
    input: { deleteOutboundShipments: $deleteOutboundShipments }
  ) {
    __typename
    deleteOutboundShipments {
      __typename
      id
    }
  }
}

mutation upsertOutboundShipment(
  $storeId: String!
  $input: BatchOutboundShipmentInput!
) {
  batchOutboundShipment(storeId: $storeId, input: $input) {
    deleteOutboundShipmentLines {
      id
    }
    deleteOutboundShipmentServiceLines {
      id
    }
    deleteOutboundShipmentUnallocatedLines {
      id
    }
    insertOutboundShipmentLines {
      id
    }
    insertOutboundShipmentServiceLines {
      id
    }
    insertOutboundShipmentUnallocatedLines {
      id
    }
    updateOutboundShipmentLines {
      id
    }
    updateOutboundShipmentServiceLines {
      id
    }
    updateOutboundShipmentUnallocatedLines {
      id
    }
    updateOutboundShipments {
      id
    }
  }
}

mutation deleteOutboundShipmentLines(
  $storeId: String!
  $deleteOutboundShipmentLines: [DeleteOutboundShipmentLineInput!]!
) {
  batchOutboundShipment(
    storeId: $storeId
    input: { deleteOutboundShipmentLines: $deleteOutboundShipmentLines }
  ) {
    deleteOutboundShipmentLines {
      id
      response {
        ... on DeleteOutboundShipmentLineError {
          __typename
          error {
            description
            ... on RecordNotFound {
              __typename
              description
            }
            ... on CannotEditInvoice {
              __typename
              description
            }
            ... on DatabaseError {
              __typename
              description
              fullError
            }
            ... on ForeignKeyError {
              __typename
              description
              key
            }
            ... on InvoiceDoesNotBelongToCurrentStore {
              __typename
              description
            }
            ... on InvoiceLineBelongsToAnotherInvoice {
              __typename
              description
            }
            ... on NotAnOutboundShipment {
              __typename
              description
            }
          }
        }
        ... on DeleteResponse {
          id
        }
      }
    }
  }
}

query invoiceCounts($timezoneOffset: Int) {
  invoiceCounts(timezoneOffset: $timezoneOffset) {
    outbound {
      created {
        today
        thisWeek
      }
      toBePicked
    }
  }
}
